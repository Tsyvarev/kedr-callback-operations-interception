<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>4. Interceptors already implemented in KEDR COI</title><link rel="stylesheet" href="kedr-coi-doc.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.75.2"><link rel="home" href="index.html" title="KEDR COI 0.1 Reference Manual"><link rel="up" href="index.html" title="KEDR COI 0.1 Reference Manual"><link rel="prev" href="using_kedr_coi.html" title="3. Using KEDR COI"><link rel="next" href="create_interceptors_using_kedr_gen.html" title="5. Create interceptors using template-based file generation"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">4. Interceptors already implemented in KEDR COI</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="using_kedr_coi.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="create_interceptors_using_kedr_gen.html">Next</a></td></tr></table><hr></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="pre_existed_interceptors"></a>4. Interceptors already implemented in KEDR COI</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="pre_existed_interceptors.html#pre_existed_interceptors.interceptor_api">4.1. Object type-specific interceptor's API</a></span></dt><dt><span class="section"><a href="pre_existed_interceptors.html#pre_existed_interceptors.foreign_interceptor_api">4.2. Object type-specific foreign interceptor's API</a></span></dt><dt><span class="section"><a href="pre_existed_interceptors.html#pre_existed_interceptors.list">4.3. List of interceptors defined in KEDR COI</a></span></dt></dl></div><p>
Aside from providing basic API for implementing interceptors for any object's type, KEDR COI provide ready-made API and its implementation for some interceptors.
</p><p>
For each such interceptor its API is declared in header file placed in <code class="filename">/usr/local/include/kedr-coi/interceptors</code> directory and implemented in source file placed in <code class="filename">/usr/local/share/kedr-coi/interceptors</code> directory. So, for use this API one should use include directive like this <code class="code">#include &lt;kedr-coi/interceptors/<em class="replaceable"><code>interceptor_name.h</code></em>&gt;</code> and use corresponded source file when compile kernel module.
</p><p>
Each specific interceptor implementation use its own string as prefix for all exported functions, definitions and macro. In the API description below <em class="replaceable"><code>prefix</code></em> will denote this prefix; <em class="replaceable"><code>object_t</code></em> will denote object type for which the interceptor is intended to use.
</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="pre_existed_interceptors.interceptor_api"></a>4.1. Object type-specific interceptor's API</h3></div></div></div><p>
Next functions are defined for interceptor for object of specific type:
</p><div class="variablelist"><dl><dt><span class="term">int <em class="replaceable"><code>prefix</code></em>_init(void (*trace_unforgotten_object)(<em class="replaceable"><code>object_t</code></em>*  object))</span></dt><dd>Initialize interceptor. 'trace_unforgotten_object' has same sence as so-named parameter of instrumentor constructor. Wrapper around of <a class="link" href="api_reference.html#api_reference.interceptor_creation.indirect">kedr_coi_interceptor_create</a> or <a class="link" href="api_reference.html#api_reference.interceptor_creation.direct">kedr_coi_interceptor_create_direct</a> depended whether interceptor is indirect or direct. Return 0 if interceptor was successfully created and negative error code otherwise.</dd><dt><span class="term">void <em class="replaceable"><code>prefix</code></em>_destroy(void);</span></dt><dd>Destroy interceptor, freeing all resources used by it. Wrapper around <a class="link" href="api_reference.html#api_reference.interceptor_creation.destroy">kedr_coi_interceptor_destroy</a>.</dd><dt><span class="term">int <em class="replaceable"><code>prefix</code></em>_payload_register(struct kedr_coi_payload* payload);</span></dt><dd>Register payload for this interceptor. Wrapper around <a class="link" href="api_reference.html#api_reference.interceptor.payload_register">kedr_coi_payload_register</a>.</dd><dt><span class="term">int <em class="replaceable"><code>prefix</code></em>_payload_unregister(struct kedr_coi_payload* payload);</span></dt><dd>Deregister payload for this interceptor. Wrapper around <a class="link" href="api_reference.html#api_reference.interceptor.payload_unregister">kedr_coi_payload_unregister</a>.</dd><dt><span class="term">int <em class="replaceable"><code>prefix</code></em>_start(void);</span></dt><dd>Start to intercept. Wrapper around <a class="link" href="api_reference.html#api_reference.interceptor.start">kedr_coi_interceptor_start</a>.</dd><dt><span class="term">void <em class="replaceable"><code>prefix</code></em>_stop(void);</span></dt><dd>Stop to intercept. Wrapper around <a class="link" href="api_reference.html#api_reference.interceptor.stop">kedr_coi_interceptor_stop</a>.</dd><dt><span class="term">int <em class="replaceable"><code>prefix</code></em>_watch(<em class="replaceable"><code>object_t</code></em>* object);</span></dt><dd>Watch for an object. Wrapper around <a class="link" href="api_reference.html#api_reference.interceptor.watch">kedr_coi_interceptor_watch</a>.</dd><dt><span class="term">int <em class="replaceable"><code>prefix</code></em>_forget(<em class="replaceable"><code>object_t</code></em>* object);</span></dt><dd>Stop to watch for an object. Wrapper around <a class="link" href="api_reference.html#api_reference.interceptor.forget">kedr_coi_interceptor_forget</a>.</dd><dt><span class="term">int <em class="replaceable"><code>prefix</code></em>_forget_norestore(<em class="replaceable"><code>object_t</code></em>* object);</span></dt><dd>Stop to watch for an object and doesn't restore object's content. Wrapper around <a class="link" href="api_reference.html#api_reference.interceptor.forget_norestore">kedr_coi_interceptor_forget_norestore</a>.</dd></dl></div><p>
</p><p>
Also, for each operation &lt;op&gt; which is allowable for intercept using this interceptor,
next macros are defined:
</p><div class="variablelist"><dl><dt><span class="term"><em class="replaceable"><code>prefix</code></em>_&lt;op&gt;_pre(func)</span></dt><dd>Use function as pre-handler for operation. Also check that function has correct signature.</dd><dt><span class="term"><em class="replaceable"><code>prefix</code></em>_&lt;op&gt;_post(func)</span></dt><dd>Use function as post-handler for operation. Also check that function has correct signature.</dd></dl></div><p>
</p><p>
Also, for indirect interceptor next function will be exported for create foreign interceptor for this one:
</p><pre class="programlisting">
struct kedr_coi_foreign_interceptor*
<em class="replaceable"><code>prefix</code></em>_foreign_interceptor_create(const char* name,
    size_t foreign_operations_field_offset,
    const struct kedr_coi_foreign_intermediate* intermediate_operations,
    void (*trace_unforgotten_object)(void* object));
</pre><p>

It is a wrapper around <a class="link" href="api_reference.html#api_reference.foreign_interceptor_creation.indirect">kedr_coi_foreign_interceptor_create</a>.
</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="pre_existed_interceptors.foreign_interceptor_api"></a>4.2. Object type-specific foreign interceptor's API</h3></div></div></div><p>
Next function is defined create foreign interceptor for object of specific type:
</p><pre class="programlisting">
extern int <em class="replaceable"><code>prefix</code></em>_interceptor_init(
    struct kedr_coi_foreign_interceptor* (*foreign_interceptor_create)(
        const char* name,
        size_t foreign_operations_field_offset,
        const struct kedr_coi_foreign_intermediate* intermediate_operations,
        void (*trace_unforgotten_object)(void* object)),
    void (*trace_unforgotten_object)(<em class="replaceable"><code>object_t</code></em>* object));
</pre><p>
The first argument is expected to be a function '<em class="replaceable"><code>prefix</code></em>_foreign_interceptor_create' generated for a normal interceptor, second argument has same sence as so-named argument of <code class="function">kedr_coi_foreign_interceptor_create</code>. Return 0 if foreign interceptor was successfully created and negative error code otherwise.
</p><p>
Also, next functions will be defined:
</p><div class="variablelist"><dl><dt><span class="term">void <em class="replaceable"><code>prefix</code></em>_destroy(void);</span></dt><dd>Destroy interceptor, freeing all resources used by it. Wrapper around <a class="link" href="api_reference.html#api_reference.foreign_interceptor_creation.destroy">kedr_coi_foreign_interceptor_destroy</a>.</dd><dt><span class="term">int <em class="replaceable"><code>prefix</code></em>_watch(<em class="replaceable"><code>object_t</code></em>* object);</span></dt><dd>Watch for an object. Wrapper around <a class="link" href="api_reference.html#api_reference.foreign_interceptor.watch">kedr_coi_foreign_interceptor_watch</a>.</dd><dt><span class="term">int <em class="replaceable"><code>prefix</code></em>_forget(<em class="replaceable"><code>object_t</code></em>* object);</span></dt><dd>Stop to watch for an object. Wrapper around <a class="link" href="api_reference.html#api_reference.foreign_interceptor.forget">kedr_coi_foreign_interceptor_forget</a>.</dd><dt><span class="term">int <em class="replaceable"><code>prefix</code></em>_forget_norestore(<em class="replaceable"><code>object_t</code></em>* object);</span></dt><dd>Stop to watch for an object and doesn't restore object's content. Wrapper around <a class="link" href="api_reference.html#api_reference.foreign_interceptor.forget_norestore">kedr_coi_foreign_interceptor_forget_norestore</a>.</dd></dl></div><p>
</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="pre_existed_interceptors.list"></a>4.3. List of interceptors defined in KEDR COI</h3></div></div></div><p>
Here is a list of functions' prefixes, used for create and work with interceptors for particular objects' types.
</p><div class="variablelist"><dl><dt><span class="term">file_operations_interceptor</span></dt><dd>Interceptor for watch objects of type '<span class="type">struct file</span>'. Name of header file is <code class="filename">file_operations_interceptor.h</code>. Name of source file - <code class="filename">file_operations_interceptor.c</code>.
        </dd></dl></div><p>
</p></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="using_kedr_coi.html">Prev</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="create_interceptors_using_kedr_gen.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">3. Using KEDR COI </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 5. Create interceptors using template-based file generation</td></tr></table></div></body></html>
